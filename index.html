<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Role-based Database</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #000;
      background: url('https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0') no-repeat center center fixed;
      background-size: cover;
    }
    .overlay {
      background: radial-gradient(circle at top left, rgba(255,0,0,0.4), transparent 40%),
                  radial-gradient(circle at bottom right, rgba(0,0,255,0.4), transparent 40%);
      min-height: 100vh;
      padding: 20px;
    }
    .card {
      background: rgba(255,255,255,0.9);
      border-radius: 14px;
      padding: 20px;
      max-width: 600px;
      margin: 20px auto;
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }
    h1, h3 {
      text-align: center;
      margin: 0 0 15px 0;
      text-shadow: 0 0 8px rgba(255,0,0,0.6), 0 0 8px rgba(0,0,255,0.6);
    }
    label { display:block; margin:8px 0 4px; font-weight:600; }
    input, select, button {
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid #ccc;
      margin-bottom:10px;
      font-size:14px;
    }
    button.primary {
      background: linear-gradient(90deg, red, blue);
      border: none;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { padding:8px; border-bottom:1px solid #ddd; text-align:left; }
    .actions { display:flex; gap:6px; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="overlay">
    <div class="card" id="loginCard">
      <h1>Login Manager</h1>
      <label>Username</label>
      <input id="loginUser" placeholder="username" />
      <label>Password</label>
      <input id="loginPass" type="password" placeholder="password" />
      <button id="btnLogin" class="primary">Login</button>
    </div><div class="card hidden" id="app">
  <h1>Dashboard</h1>
  <div id="profile"></div>
  <button id="btnLogout" class="primary">Logout</button>

  <h3>Users</h3>
  <div id="userControls" class="hidden">
    <label>Tambah Akun</label>
    <input id="newUser" placeholder="username" />
    <input id="newPass" placeholder="password" />
    <select id="newRole">
      <option>owner</option>
      <option>CEO</option>
      <option>mods</option>
      <option>partner</option>
      <option>reseller</option>
    </select>
    <input id="newExp" placeholder="Exp (YYYY-MM-DD)" />
    <button id="btnCreate" class="primary">Create Account</button>
  </div>
  <table>
    <thead><tr><th>Username</th><th>Role</th><th>Action</th></tr></thead>
    <tbody id="usersTbody"></tbody>
  </table>

  <h3>Tokens</h3>
  <div id="tokenControls" class="hidden">
    <input id="tokenValue" placeholder="token value" />
    <button id="btnAddToken" class="primary">Add Token</button>
  </div>
  <table>
    <thead><tr><th>Token</th><th>Owner</th><th>Action</th></tr></thead>
    <tbody id="tokensTbody"></tbody>
  </table>
</div>

  </div>  <script>
    // --- CONFIG ---
    const USERS_URL = "https://raw.githubusercontent.com/noxxasoloera/WebManager/refs/heads/main/users.json";
    const TOKENS_URL = "https://raw.githubusercontent.com/noxxasoloera/WebManager/refs/heads/main/tokens.json";

    let users = [];
    let tokens = [];
    let current = null;

    async function loadData(){
      try {
        const u = await fetch(USERS_URL).then(r=>r.json());
        const t = await fetch(TOKENS_URL).then(r=>r.json());
        users = Array.isArray(u)? u : u.users;
        tokens = Array.isArray(t)? t : t.tokens;
      } catch(e){ console.error(e); }
    }

    function canCreateRole(role,target){
      if(role==='owner') return true;
      if(role==='CEO') return !['owner','CEO'].includes(target);
      if(role==='mods') return ['partner','reseller'].includes(target);
      if(role==='partner') return target==='reseller';
      return false;
    }

    function render(){
      document.getElementById('profile').innerHTML = `Login sebagai: <b>${current.username}</b> (role: ${current.role})`;
      // User table
      const tbody=document.getElementById('usersTbody'); tbody.innerHTML="";
      users.forEach((u,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${u.username}</td><td>${u.role}</td>`;
        const td=document.createElement('td');
        if(['owner','CEO'].includes(current.role)){
          const btn=document.createElement('button'); btn.textContent='Delete'; btn.className='primary';
          btn.onclick=()=>{ if(confirm('Delete '+u.username+'?')){ users.splice(i,1); render(); } };
          td.appendChild(btn);
        }
        tr.appendChild(td);
        tbody.appendChild(tr);
      });

      // Tokens
      const tbodyT=document.getElementById('tokensTbody'); tbodyT.innerHTML="";
      if(['owner','CEO'].includes(current.role)){
        tokens.forEach((t,i)=>{
          const tr=document.createElement('tr');
          tr.innerHTML=`<td>${t.value}</td><td>${t.owner}</td>`;
          const td=document.createElement('td');
          const btn=document.createElement('button'); btn.textContent='Delete'; btn.className='primary';
          btn.onclick=()=>{ if(confirm('Delete token?')){ tokens.splice(i,1); render(); } };
          td.appendChild(btn);
          tr.appendChild(td);
          tbodyT.appendChild(tr);
        });
      } else {
        tbodyT.innerHTML = '<tr><td colspan="3">Tidak bisa melihat token</td></tr>';
      }

      // Controls
      if(canCreateRole(current.role,'reseller')){
        document.getElementById('userControls').classList.remove('hidden');
      }
      if(['owner','CEO','mods','partner','reseller'].includes(current.role)){
        document.getElementById('tokenControls').classList.remove('hidden');
      }
    }

    document.getElementById('btnLogin').onclick=()=>{
      const u=document.getElementById('loginUser').value.trim();
      const p=document.getElementById('loginPass').value;
      const found=users.find(x=>x.username===u && x.password===p);
      if(!found) return alert('Login gagal');
      current=found;
      document.getElementById('loginCard').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
      render();
    };

    document.getElementById('btnLogout').onclick=()=>{ location.reload(); };

    document.getElementById('btnCreate').onclick=()=>{
      const username=document.getElementById('newUser').value.trim();
      const password=document.getElementById('newPass').value;
      const role=document.getElementById('newRole').value;
      const exp=document.getElementById('newExp').value;
      if(!canCreateRole(current.role,role)) return alert('Tidak bisa buat role ini');
      if(users.find(u=>u.username===username)) return alert('Sudah ada');
      users.push({username,password,role,exp});
      render();
    };

    document.getElementById('btnAddToken').onclick=()=>{
      const val=document.getElementById('tokenValue').value.trim();
      if(!val) return;
      tokens.push({value:val,owner:current.username});
      render();
    };

    loadData();
  </script></body>
</html>